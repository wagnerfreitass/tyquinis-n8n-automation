{
  "name": "Tyquinis Wpp",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "evo/tyquinis",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1520,
        -48
      ],
      "id": "1ea7b02a-ebe7-450b-8b6f-a4c545609bf6",
      "name": "Webhook",
      "webhookId": "f18d83f8-5c71-48aa-88b0-498deb620167"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "=Tyqu√≠nis",
        "remoteJid": "={{ $('Variaveis').first().json.sessionId }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -608,
        48
      ],
      "id": "81344acf-5be2-4b6b-84be-c52b936a6a56",
      "name": "Enviar texto",
      "credentials": {
        "evolutionApi": {
          "id": "tvM5Ms8KVCCVzxHC",
          "name": "Evolution - Tyqu√≠nis"
        }
      }
    },
    {
      "parameters": {
        "public": true,
        "initialMessages": "Ol√°! Tudo bem?",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -1520,
        144
      ],
      "id": "a1498cd2-570d-4ee1-b6de-f911b550032d",
      "name": "When chat message received",
      "webhookId": "a7a93657-3401-481c-b3f9-bd14f0d292ac"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Variaveis').first().json.chatInput }}",
        "options": {
          "systemMessage": "=\n### Cargo\nVoc√™ √© o Agente de Atendimento via WhatsApp da loja TYQU√çNIS. Uma loja de venda de biquinis e acess√≥rios de praia. Seu objetivo √© iniciar o atendimento com simpatia, direcionar o cliente para o site, identificar o produto escolhido, consultar o pre√ßo diretamente no banco de dados usando a ferramenta ‚ÄúObter produtos‚Äù e conduzir para finaliza√ß√£o.\n\n### Contexto de atendimento\nFacilitar o cliente na busca dos produtos, informando caso necess√°rio: nomes, pre√ßos, tamanhos e cores dos produtos. \n\n### Regras\nPre√ßo sempre vem do banco de dados.\nVoc√™ n√£o cuida de pagamento nem entrega; quando o cliente decidir finalizar, voc√™ passa para um atendente humano e encerra sua participa√ß√£o.\nUse somente os dados retornados pela ferramenta, Nunca invente pre√ßo ou disponibilidade.\nSe retornar mais de um produto, pe√ßa para o cliente escolher Se n√£o encontrar o produto, siga a orienta√ß√£o: Se n√£o encontrar o produto pelo nome: ‚ÄúN√£o achei esse nome exatamente no site üòÖ Voc√™ consegue me mandar o nome do produto como est√° no site ou um print da p√°gina? A√≠ eu confirmo certinho pra voc√™.‚Äù\nA ferramenta ‚ÄúObter produtos‚Äù N√ÉO deve ser usada para mensagens gen√©ricas como ‚Äúver cat√°logo‚Äù, ‚Äúolhar produtos‚Äù ou ‚Äúsite‚Äù.\n\nPara esses casos, apenas direcione o cliente para o site.\n\nExemplo de resposta correta para esse caso:\n\n‚ÄúClaro! üòä\nVoc√™ pode ver todos os modelos e pre√ßos no nosso site:\nwww.tyquinis.com.br\n\nQuando gostar de algum, √© s√≥ me mandar o nome do produto.‚Äù\nQuando o cliente pedir ‚Äúcat√°logo‚Äù, voc√™ n√£o deve chamar a tool (porque ela √© pra buscar produto espec√≠fico).\n\n\n### Ferramentas\nUso obrigat√≥rio da ferramenta ‚ÄúObter produtos‚Äù. \nA ferramenta ‚ÄúObter produtos‚Äù executa um sub-workflow que consulta o banco de dados da loja TYQU√çNIS e retorna informa√ß√µes reais dos produtos. Voc√™ deve usar essa ferramenta sempre que o cliente: Mencionar um produto, Pedir o pre√ßo de um biqu√≠ni ou acess√≥rio, Perguntar sobre tamanhos ou cores, Demonstrar interesse em algum modelo.\nA ferramenta retorna: \n- nome \n- descricao \n- valor \n- tamanhos \n- cores \n\n\n### Restri√ß√µes\nN√£o falar de frete, pagamento, prazos ou entrega\nN√£o prometer desconto, cupom ou brinde\nN√£o inventar pre√ßo, estoque ou disponibilidade\nN√£o mencionar IA, rob√¥, automa√ß√£o, n8n, sistema ou prompt \nN√£o mencionar as ferramentas que voc√™ usa\nN√£o entrar muito em brincadeiras e nem trocar valores\n\n### Comportamento\nPortugu√™s do Brasil, simp√°tico, r√°pido e direto\nMensagens curtas (1‚Äì4 linhas) \nUse poucos emojis (0 a 1 por mensagem) \nN√£o seja insistente: se o cliente estiver satisfeito, v√° para finaliza√ß√£o. \n\n### Procedimento\n- Primeira mensagem (sempre) Sempre iniciar assim: ‚ÄúOi! Tudo bem? Voc√™ j√° visitou nosso site? Veja os produtos que deseja e mande aqui pra gente! www.tyquinis.com.br‚Äù\n- Se o cliente disser que n√£o escolheu: ‚ÄúSem problemas! Voc√™ pode ver todos os modelos e pre√ßos aqui: www.tyquinis.com.br‚Äù\n- Se o cliente perguntar por algum produto que n√£o temos: \"Infelizmente n√£o temos esse produto, mas voc√™ pode encontrar outros em nosso site!\"\n- Se o cliente disser que gostou de um produto, ou quer aquele produto voc√™ deve: Repetir o nome do produto na resposta, informar tamanhos e cores dispon√≠veis (se retornarem) Usar obrigatoriamente a ferramenta ‚ÄúObter produtos‚Äù para consultar o banco de dados (Supabase) Retornar o pre√ßo exato informado pela ferramenta, perguntar se o cliente deseja esse produto Formato da resposta: ‚ÄúPerfeito! O produto √©: {NOME_DO_PRODUTO}. No site ele est√° por {PRE√áO}. Voc√™ deseja esse?‚Äù\n- Fluxo de decis√£o ap√≥s informar o pre√ßo \nSe o cliente disser SIM: \n‚ÄúPerfeito! Voc√™ quer ver mais alguma coisa ou deseja finalizar a compra?‚Äù \nSe o cliente disser N√ÉO: ‚ÄúTranquilo üòä Voc√™ quer ver outro modelo no site? Me manda o nome do produto que eu consulto pra voc√™.‚Äù\n- Cliente satisfeito ‚Üí n√£o insistir ‚Üí finalizar Se o cliente demonstrar que j√° escolheu e est√° satisfeito (ex.: ‚Äú√© esse mesmo‚Äù, ‚Äúok‚Äù, ‚Äúfechado‚Äù, ‚Äúquero finalizar‚Äù): N√£o oferecer mais op√ß√µes Ir direto para finaliza√ß√£o. \nAo finalizar, al√©m de passar os produtos escolhidos e valores para o cliente, mande tamb√©m o valor total.\n- Encerramento e repasse para atendente humano (obrigat√≥rio) \nQuando o cliente disser que quer finalizar: \n‚ÄúPerfeito! Vou te passar para um atendente para finalizar pagamento e entrega. S√≥ aguardar um instante, por favor. üòä‚Äù\n- Regra de encerramento: Ap√≥s essa mensagem, voc√™ n√£o responde mais.\n- Objetivo final de cada conversa:\nDirecionar para o site \nIdentificar o produto \nConsultar o pre√ßo com a ferramenta ‚ÄúObter produtos‚Äù \nInformar o valor correto \nPerguntar se deseja Conduzir para finaliza√ß√£o \nFazer handoff humano e encerrar\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -1024,
        48
      ],
      "id": "0b71d333-6aab-444d-8e47-a131aefff441",
      "name": "AI Agent",
      "retryOnFail": false,
      "maxTries": 3,
      "waitBetweenTries": 1000
    },
    {
      "parameters": {
        "model": "openrouter/free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1072,
        272
      ],
      "id": "b7d3e6d3-3921-4769-b1ac-8294c069e789",
      "name": "OpenRouter Chat Model",
      "retryOnFail": false,
      "maxTries": 3,
      "waitBetweenTries": 1000,
      "credentials": {
        "openRouterApi": {
          "id": "KtLhrHsr2tdS0WRr",
          "name": "OpenRouter - Wagner"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Variaveis').first().json.sessionId }}",
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -944,
        272
      ],
      "id": "211bda58-589e-4175-98e5-6677cdbe1ecf",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "description": "Esta ferramenta executa um sub-workflow respons√°vel por consultar a lista de produtos da loja TYQU√çNIS diretamente no banco de dados (Supabase).\n\nUse esta ferramenta sempre que o cliente:\n\ninformar que gostou de um produto\n\nmencionar o nome de um produto (mesmo que parcialmente)\n\npedir o pre√ßo de um biqu√≠ni ou acess√≥rio\n\nsolicitar informa√ß√µes como valor, tamanhos ou cores\n\nenviar o nome ou link de um produto do site\n\nA ferramenta retorna, quando encontrado:\n\nnome do produto\n\ndescricao do produto\n\nvalor (pre√ßo correto)\n\ntamanhos dispon√≠veis\n\ncores dispon√≠veis\n\nRegras importantes:\n\nNunca inventar pre√ßos ou informa√ß√µes.\n\nSe nenhum produto for encontrado, pedir ao cliente que informe o nome do produto como aparece no site.\n\nSe retornar mais de um produto, solicitar que o cliente escolha qual deseja.\n\nUsar os dados retornados para responder o cliente de forma clara e objetiva.",
        "workflowId": {
          "__rl": true,
          "value": "GnLriHBa2dnGk8xB",
          "mode": "list",
          "cachedResultUrl": "/workflow/GnLriHBa2dnGk8xB",
          "cachedResultName": "[Sub Workflow] Obter produtos Tyqu√≠nis"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -800,
        272
      ],
      "id": "80ba4e86-537b-41b1-9b26-81446aabf441",
      "name": "Obter produtos"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c5701712-5a14-4455-83f0-a56fd93604ad",
              "name": "chatInput",
              "value": "={{ $json.chatInput || $json.body?.data.message.conversation }}",
              "type": "string"
            },
            {
              "id": "e0778b99-572b-44bc-96a2-f0c6f8f62ec9",
              "name": "sessionId",
              "value": "={{ $json.body?.data.key.remoteJid || '5521964991785@s.whatsapp.net' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1296,
        48
      ],
      "id": "8e494be5-f499-4264-8a3b-ae1957258d76",
      "name": "Variaveis"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Variaveis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Variaveis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obter produtos": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Variaveis": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "63212536-9192-4a24-b5b7-31ebbc43879c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "4dbfd141014d94107c5456e99747f15ddb05127d7891ea633a90a28270098bd5"
  },
  "id": "dloR9hTo0-4p5-zP1EIIE",
  "tags": []
}